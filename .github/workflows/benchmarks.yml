name: ðŸŒ Benchmarks

on:
  pull_request:
    branches:
      - "main"
  workflow_dispatch:

jobs:
  benchmarks:
    name: ðŸŒ Benchmarks
    runs-on: ubuntu-22.04
    permissions:
      pull-requests: write
    steps:
      - name: ðŸšš Checkout
        uses: actions/checkout@v3
      - name: âš™ Restore
        run: dotnet restore
      - name: ðŸ­ Build
        run: dotnet build --no-restore -c Release
      - name: ðŸŒ Run all benchmarks
        working-directory: tests/benchmarks
        run: dotnet run -c Release -- -f *
      - name: ðŸ“ Add summary
        working-directory: tests/benchmarks/BenchmarkDotNet.Artifacts/results
        run: cat FingerprintBuilder.BenchmarkTests.ModelToHex-report-github.md >> $GITHUB_STEP_SUMMARY
      - name: ðŸ’¬ Add PR comment
        uses: marocchino/sticky-pull-request-comment@v2
        if: github.event_name == 'pull_request'
        with:
          recreate: true
          path: tests/benchmarks/BenchmarkDotNet.Artifacts/results/FingerprintBuilder.BenchmarkTests.ModelToHex-report-github.md

